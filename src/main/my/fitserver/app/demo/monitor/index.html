<div>
    <canvas id="myChart"></canvas>
</div>

<script src="chart-3.9.1.js"></script>
<script>

    var httpRequest = new XMLHttpRequest();

    function request(action, url, input, callback) {
        httpRequest.open(action, url, true);
        httpRequest.onreadystatechange = function(message) {
            if (httpRequest.readyState == 4 && httpRequest.status == 200) {
                callback(httpRequest.responseText);
            }
        };
        var body = null;
        if(typeof(input)==="string") {
            body = input;
        } else if(typeof(input)==="object") {
            body = JSON.stringify(input);
        }
        httpRequest.send(body);
    }



</script>
<script>
  const ctx = document.getElementById('myChart');

    const colorMap = {
        "free": 'rgb(0, 255, 0)',
        "used": 'rgb(220, 0, 0)',
        "user": 'rgb(120, 0, 0)',
        "sys": 'rgb(150, 100, 0)',
        "wait": 'rgb(200, 0, 50)',
    };
    function addPoint(labels, datasets, pointData) {
        for(var i=0; i<labels.length; i++) {
            if(datasets[i] == null) {
                datasets[i] = {};
                datasets[i].data = [];
            }
            datasets[i].label = labels[i];
            datasets[i].data.push(pointData[labels[i]]);

            datasets[i].borderColor = colorMap[labels[i]];
        }
    }

    function fetch() {
        var url = "/monitor/get"
        request("POST", url, "", function(body){
           var result = JSON.parse(body);

           var data =  {labels:[],datasets:[]};
           for(var i=0; i<result.cpu.length; i++) {
               data.labels[i] = result.cpu[i].timestampShow;
               addPoint(["used", "free", "user", "sys", "wait"], data.datasets, result.cpu[i]);
           }

           new Chart(ctx, {
           type: 'line',
           data: data,
         });
        });
    }

    fetch();

</script>